import{a as W,g as N}from"./index-C8GsV-Nj.js";var q={exports:{}};/*!

pica
https://github.com/nodeca/pica

*/var Y;function X(){return Y||(Y=1,function(T,Z){(function(w){T.exports=w()})(function(){return function(){function w(C,S,d){function v(i,n){if(!S[i]){if(!C[i]){var e=typeof W=="function"&&W;if(!n&&e)return e(i,!0);if(a)return a(i,!0);var t=new Error("Cannot find module '"+i+"'");throw t.code="MODULE_NOT_FOUND",t}var I=S[i]={exports:{}};C[i][0].call(I.exports,function(o){var f=C[i][1][o];return v(f||o)},I,I.exports,w,C,S,d)}return S[i].exports}for(var a=typeof W=="function"&&W,A=0;A<d.length;A++)v(d[A]);return v}return w}()({1:[function(w,C,S){var d=w("multimath"),v=w("./mm_unsharp_mask"),a=w("./mm_resize");function A(i){var n=i||[],e={js:n.indexOf("js")>=0,wasm:n.indexOf("wasm")>=0};d.call(this,e),this.features={js:e.js,wasm:e.wasm&&this.has_wasm()},this.use(v),this.use(a)}A.prototype=Object.create(d.prototype),A.prototype.constructor=A,A.prototype.resizeAndUnsharp=function(n,e){var t=this.resize(n,e);return n.unsharpAmount&&this.unsharp_mask(t,n.toWidth,n.toHeight,n.unsharpAmount,n.unsharpRadius,n.unsharpThreshold),t},C.exports=A},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(w,C,S){function d(e){return e<0?0:e>255?255:e}function v(e){return e>=0?e:0}function a(e,t,I,o,f,u){var c,g,B,m,b,y,F,E,p,x,Q,G=0,D=0;for(p=0;p<o;p++){for(b=0,x=0;x<f;x++){for(y=u[b++],F=u[b++],E=G+y*4|0,c=g=B=m=0;F>0;F--)Q=u[b++],m=m+Q*e[E+3]|0,B=B+Q*e[E+2]|0,g=g+Q*e[E+1]|0,c=c+Q*e[E]|0,E=E+4|0;t[D+3]=v(m>>7),t[D+2]=v(B>>7),t[D+1]=v(g>>7),t[D]=v(c>>7),D=D+o*4|0}D=(p+1)*4|0,G=(p+1)*I*4|0}}function A(e,t,I,o,f,u){var c,g,B,m,b,y,F,E,p,x,Q,G=0,D=0;for(p=0;p<o;p++){for(b=0,x=0;x<f;x++){for(y=u[b++],F=u[b++],E=G+y*4|0,c=g=B=m=0;F>0;F--)Q=u[b++],m=m+Q*e[E+3]|0,B=B+Q*e[E+2]|0,g=g+Q*e[E+1]|0,c=c+Q*e[E]|0,E=E+4|0;c>>=7,g>>=7,B>>=7,m>>=7,t[D+3]=d(m+8192>>14),t[D+2]=d(B+8192>>14),t[D+1]=d(g+8192>>14),t[D]=d(c+8192>>14),D=D+o*4|0}D=(p+1)*4|0,G=(p+1)*I*4|0}}function i(e,t,I,o,f,u){var c,g,B,m,b,y,F,E,p,x,Q,G,D=0,O=0;for(x=0;x<o;x++){for(y=0,Q=0;Q<f;Q++){for(F=u[y++],E=u[y++],p=D+F*4|0,c=g=B=m=0;E>0;E--)G=u[y++],b=e[p+3],m=m+G*b|0,B=B+G*e[p+2]*b|0,g=g+G*e[p+1]*b|0,c=c+G*e[p]*b|0,p=p+4|0;B=B/255|0,g=g/255|0,c=c/255|0,t[O+3]=v(m>>7),t[O+2]=v(B>>7),t[O+1]=v(g>>7),t[O]=v(c>>7),O=O+o*4|0}O=(x+1)*4|0,D=(x+1)*I*4|0}}function n(e,t,I,o,f,u){var c,g,B,m,b,y,F,E,p,x,Q,G=0,D=0;for(p=0;p<o;p++){for(b=0,x=0;x<f;x++){for(y=u[b++],F=u[b++],E=G+y*4|0,c=g=B=m=0;F>0;F--)Q=u[b++],m=m+Q*e[E+3]|0,B=B+Q*e[E+2]|0,g=g+Q*e[E+1]|0,c=c+Q*e[E]|0,E=E+4|0;c>>=7,g>>=7,B>>=7,m>>=7,m=d(m+8192>>14),m>0&&(c=c*255/m|0,g=g*255/m|0,B=B*255/m|0),t[D+3]=m,t[D+2]=d(B+8192>>14),t[D+1]=d(g+8192>>14),t[D]=d(c+8192>>14),D=D+o*4|0}D=(p+1)*4|0,G=(p+1)*I*4|0}}C.exports={convolveHor:a,convolveVert:A,convolveHorWithPre:i,convolveVertWithPre:n}},{}],3:[function(w,C,S){C.exports="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"},{}],4:[function(w,C,S){C.exports={name:"resize",fn:w("./resize"),wasm_fn:w("./resize_wasm"),wasm_src:w("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(w,C,S){var d=w("./resize_filter_gen"),v=w("./convolve"),a=v.convolveHor,A=v.convolveVert,i=v.convolveHorWithPre,n=v.convolveVertWithPre;function e(I,o,f){for(var u=3,c=o*f*4|0;u<c;){if(I[u]!==255)return!0;u=u+4|0}return!1}function t(I,o,f){for(var u=3,c=o*f*4|0;u<c;)I[u]=255,u=u+4|0}C.exports=function(o){var f=o.src,u=o.width,c=o.height,g=o.toWidth,B=o.toHeight,m=o.scaleX||o.toWidth/o.width,b=o.scaleY||o.toHeight/o.height,y=o.offsetX||0,F=o.offsetY||0,E=o.dest||new Uint8Array(g*B*4),p=typeof o.filter>"u"?"mks2013":o.filter,x=d(p,u,g,m,y),Q=d(p,c,B,b,F),G=new Uint16Array(g*c*4);return e(f,u,c)?(i(f,G,u,c,g,x),n(G,E,c,g,B,Q)):(a(f,G,u,c,g,x),A(G,E,c,g,B,Q),t(E,g,B)),E}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(w,C,S){var d=w("./resize_filter_info"),v=14;function a(A){return Math.round(A*((1<<v)-1))}C.exports=function(i,n,e,t,I){var o=d.filter[i].fn,f=1/t,u=Math.min(1,t),c=d.filter[i].win/u,g,B,m,b,y,F,E,p,x,Q,G,D,O,U,r,h,s,_=Math.floor((c+1)*2),l=new Int16Array((_+2)*e),k=0,M=!l.subarray||!l.set;for(g=0;g<e;g++){for(B=(g+.5)*f+I,m=Math.max(0,Math.floor(B-c)),b=Math.min(n-1,Math.ceil(B+c)),y=b-m+1,F=new Float32Array(y),E=new Int16Array(y),p=0,x=m,Q=0;x<=b;x++,Q++)G=o((x+.5-B)*u),p+=G,F[Q]=G;for(D=0,Q=0;Q<F.length;Q++)O=F[Q]/p,D+=O,E[Q]=a(O);for(E[e>>1]+=a(1-D),U=0;U<E.length&&E[U]===0;)U++;if(U<E.length){for(r=E.length-1;r>0&&E[r]===0;)r--;if(h=m+U,s=r-U+1,l[k++]=h,l[k++]=s,!M)l.set(E.subarray(U,r+1),k),k+=s;else for(Q=U;Q<=r;Q++)l[k++]=E[Q]}else l[k++]=0,l[k++]=0}return l}},{"./resize_filter_info":7}],7:[function(w,C,S){var d={box:{win:.5,fn:function(a){return a<0&&(a=-a),a<.5?1:0}},hamming:{win:1,fn:function(a){if(a<0&&(a=-a),a>=1)return 0;if(a<11920929e-14)return 1;var A=a*Math.PI;return Math.sin(A)/A*(.54+.46*Math.cos(A/1))}},lanczos2:{win:2,fn:function(a){if(a<0&&(a=-a),a>=2)return 0;if(a<11920929e-14)return 1;var A=a*Math.PI;return Math.sin(A)/A*Math.sin(A/2)/(A/2)}},lanczos3:{win:3,fn:function(a){if(a<0&&(a=-a),a>=3)return 0;if(a<11920929e-14)return 1;var A=a*Math.PI;return Math.sin(A)/A*Math.sin(A/3)/(A/3)}},mks2013:{win:2.5,fn:function(a){return a<0&&(a=-a),a>=2.5?0:a>=1.5?-.125*(a-2.5)*(a-2.5):a>=.5?.25*(4*a*a-11*a+7):1.0625-1.75*a*a}}};C.exports={filter:d,f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(w,C,S){var d=w("./resize_filter_gen");function v(e,t,I){for(var o=3,f=t*I*4|0;o<f;){if(e[o]!==255)return!0;o=o+4|0}return!1}function a(e,t,I){for(var o=3,f=t*I*4|0;o<f;)e[o]=255,o=o+4|0}function A(e){return new Uint8Array(e.buffer,0,e.byteLength)}var i=!0;try{i=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1}catch{}function n(e,t,I){if(i){t.set(A(e),I);return}for(var o=I,f=0;f<e.length;f++){var u=e[f];t[o++]=u&255,t[o++]=u>>8&255}}C.exports=function(t){var I=t.src,o=t.width,f=t.height,u=t.toWidth,c=t.toHeight,g=t.scaleX||t.toWidth/t.width,B=t.scaleY||t.toHeight/t.height,m=t.offsetX||0,b=t.offsetY||0,y=t.dest||new Uint8Array(u*c*4),F=typeof t.filter>"u"?"mks2013":t.filter,E=d(F,o,u,g,m),p=d(F,f,c,B,b),x=0,Q=Math.max(I.byteLength,y.byteLength),G=this.__align(x+Q),D=f*u*4*2,O=this.__align(G+D),U=this.__align(O+E.byteLength),r=U+p.byteLength,h=this.__instance("resize",r),s=new Uint8Array(this.__memory.buffer),_=new Uint32Array(this.__memory.buffer),l=new Uint32Array(I.buffer);_.set(l),n(E,s,O),n(p,s,U);var k=h.exports.convolveHV||h.exports._convolveHV;v(I,o,f)?k(O,U,G,o,f,u,c,1):(k(O,U,G,o,f,u,c,0),a(y,u,c));var M=new Uint32Array(y.buffer);return M.set(new Uint32Array(this.__memory.buffer,0,c*u)),y}},{"./resize_filter_gen":6}],9:[function(w,C,S){C.exports={name:"unsharp_mask",fn:w("./unsharp_mask"),wasm_fn:w("./unsharp_mask_wasm"),wasm_src:w("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(w,C,S){var d=w("glur/mono16");function v(a,A,i){for(var n=A*i,e=new Uint16Array(n),t,I,o,f,u=0;u<n;u++)t=a[4*u],I=a[4*u+1],o=a[4*u+2],f=t>=I&&t>=o?t:I>=o&&I>=t?I:o,e[u]=f<<8;return e}C.exports=function(A,i,n,e,t,I){var o,f,u,c,g;if(!(e===0||t<.5)){t>2&&(t=2);var B=v(A,i,n),m=new Uint16Array(B);d(m,i,n,t);for(var b=e/100*4096+.5|0,y=I<<8,F=i*n,E=0;E<F;E++)o=B[E],c=o-m[E],Math.abs(c)>=y&&(f=o+(b*c+2048>>12),f=f>65280?65280:f,f=f<0?0:f,o=o!==0?o:1,u=(f<<12)/o|0,g=E*4,A[g]=A[g]*u+2048>>12,A[g+1]=A[g+1]*u+2048>>12,A[g+2]=A[g+2]*u+2048>>12)}}},{"glur/mono16":18}],11:[function(w,C,S){C.exports=function(v,a,A,i,n,e){if(!(i===0||n<.5)){n>2&&(n=2);var t=a*A,I=t*4,o=t*2,f=t*2,u=Math.max(a,A)*4,c=8*4,g=0,B=I,m=B+o,b=m+f,y=b+f,F=y+u,E=this.__instance("unsharp_mask",I+o+f*2+u+c,{exp:Math.exp}),p=new Uint32Array(v.buffer),x=new Uint32Array(this.__memory.buffer);x.set(p);var Q=E.exports.hsv_v16||E.exports._hsv_v16;Q(g,B,a,A),Q=E.exports.blurMono16||E.exports._blurMono16,Q(B,m,b,y,F,a,A,n),Q=E.exports.unsharp||E.exports._unsharp,Q(g,g,B,m,a,A,i,e),p.set(new Uint32Array(this.__memory.buffer,0,t))}}},{}],12:[function(w,C,S){C.exports="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"},{}],13:[function(w,C,S){var d=100;function v(a,A){this.create=a,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=A||2e3}v.prototype.acquire=function(){var a=this,A;return this.available.length!==0?A=this.available.pop():(A=this.create(),A.id=this.lastId++,A.release=function(){return a.release(A)}),this.acquired[A.id]=A,A},v.prototype.release=function(a){var A=this;delete this.acquired[a.id],a.lastUsed=Date.now(),this.available.push(a),this.timeoutId===0&&(this.timeoutId=setTimeout(function(){return A.gc()},d))},v.prototype.gc=function(){var a=this,A=Date.now();this.available=this.available.filter(function(i){return A-i.lastUsed>a.idle?(i.destroy(),!1):!0}),this.available.length!==0?this.timeoutId=setTimeout(function(){return a.gc()},d):this.timeoutId=0},C.exports=v},{}],14:[function(w,C,S){var d=2;C.exports=function(a,A,i,n,e,t){var I=i/a,o=n/A,f=(2*t+d+1)/e;if(f>.5)return[[i,n]];var u=Math.ceil(Math.log(Math.min(I,o))/Math.log(f));if(u<=1)return[[i,n]];for(var c=[],g=0;g<u;g++){var B=Math.round(Math.pow(Math.pow(a,u-g-1)*Math.pow(i,g+1),1/u)),m=Math.round(Math.pow(Math.pow(A,u-g-1)*Math.pow(n,g+1),1/u));c.push([B,m])}return c}},{}],15:[function(w,C,S){var d=1e-5;function v(A){var i=Math.round(A);return Math.abs(A-i)<d?i:Math.floor(A)}function a(A){var i=Math.round(A);return Math.abs(A-i)<d?i:Math.ceil(A)}C.exports=function(i){var n=i.toWidth/i.width,e=i.toHeight/i.height,t=v(i.srcTileSize*n)-2*i.destTileBorder,I=v(i.srcTileSize*e)-2*i.destTileBorder;if(t<1||I<1)throw new Error("Internal error in pica: target tile width/height is too small.");var o,f,u,c,g,B,m=[],b;for(c=0;c<i.toHeight;c+=I)for(u=0;u<i.toWidth;u+=t)o=u-i.destTileBorder,o<0&&(o=0),g=u+t+i.destTileBorder-o,o+g>=i.toWidth&&(g=i.toWidth-o),f=c-i.destTileBorder,f<0&&(f=0),B=c+I+i.destTileBorder-f,f+B>=i.toHeight&&(B=i.toHeight-f),b={toX:o,toY:f,toWidth:g,toHeight:B,toInnerX:u,toInnerY:c,toInnerWidth:t,toInnerHeight:I,offsetX:o/n-v(o/n),offsetY:f/e-v(f/e),scaleX:n,scaleY:e,x:v(o/n),y:v(f/e),width:a(g/n),height:a(B/e)},m.push(b);return m}},{}],16:[function(w,C,S){function d(v){return Object.prototype.toString.call(v)}C.exports.isCanvas=function(a){var A=d(a);return A==="[object HTMLCanvasElement]"||A==="[object OffscreenCanvas]"||A==="[object Canvas]"},C.exports.isImage=function(a){return d(a)==="[object HTMLImageElement]"},C.exports.isImageBitmap=function(a){return d(a)==="[object ImageBitmap]"},C.exports.limiter=function(a){var A=0,i=[];function n(){A<a&&i.length&&(A++,i.shift()())}return function(t){return new Promise(function(I,o){i.push(function(){t().then(function(f){I(f),A--,n()},function(f){o(f),A--,n()})}),n()})}},C.exports.cib_quality_name=function(a){switch(a){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},C.exports.cib_support=function(a){return Promise.resolve().then(function(){if(typeof createImageBitmap>"u")return!1;var A=a(100,100);return createImageBitmap(A,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(i){var n=i.width===10;return i.close(),A=null,n})}).catch(function(){return!1})},C.exports.worker_offscreen_canvas_support=function(){return new Promise(function(a,A){if(typeof OffscreenCanvas>"u"){a(!1);return}function i(t){if(typeof createImageBitmap>"u"){t.postMessage(!1);return}Promise.resolve().then(function(){var I=new OffscreenCanvas(10,10),o=I.getContext("2d");return o.rect(0,0,1,1),createImageBitmap(I,0,0,1,1)}).then(function(){return t.postMessage(!0)},function(){return t.postMessage(!1)})}var n=btoa("(".concat(i.toString(),")(self);")),e=new Worker("data:text/javascript;base64,".concat(n));e.onmessage=function(t){return a(t.data)},e.onerror=A}).then(function(a){return a},function(){return!1})},C.exports.can_use_canvas=function(a){var A=!1;try{var i=a(2,1),n=i.getContext("2d"),e=n.createImageData(2,1);e.data[0]=12,e.data[1]=23,e.data[2]=34,e.data[3]=255,e.data[4]=45,e.data[5]=56,e.data[6]=67,e.data[7]=255,n.putImageData(e,0,0),e=null,e=n.getImageData(0,0,2,1),e.data[0]===12&&e.data[1]===23&&e.data[2]===34&&e.data[3]===255&&e.data[4]===45&&e.data[5]===56&&e.data[6]===67&&e.data[7]===255&&(A=!0)}catch{}return A},C.exports.cib_can_use_region=function(){return new Promise(function(a){if(typeof Image>"u"||typeof createImageBitmap>"u"){a(!1);return}var A=new Image;A.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",A.onload=function(){createImageBitmap(A,0,0,A.width,A.height).then(function(i){i.width===A.width&&i.height===A.height?a(!0):a(!1)},function(){return a(!1)})},A.onerror=function(){return a(!1)}})}},{}],17:[function(w,C,S){C.exports=function(){var d=w("./mathlib"),v;onmessage=function(A){var i=A.data.opts;if(!i.src&&i.srcBitmap){var n=new OffscreenCanvas(i.width,i.height),e=n.getContext("2d");e.drawImage(i.srcBitmap,0,0),i.src=e.getImageData(0,0,i.width,i.height).data,n.width=n.height=0,n=null,i.srcBitmap.close(),i.srcBitmap=null}v||(v=new d(A.data.features));var t=v.resizeAndUnsharp(i);postMessage({data:t},[t.buffer])}}},{"./mathlib":1}],18:[function(w,C,S){var d,v,a,A,i,n,e,t;function I(u){u<.5&&(u=.5);var c=Math.exp(.726*.726)/u,g=Math.exp(-c),B=Math.exp(-2*c),m=(1-g)*(1-g)/(1+2*c*g-B);return d=m,v=m*(c-1)*g,a=m*(c+1)*g,A=-m*B,i=2*g,n=-B,e=(d+v)/(1-i-n),t=(a+A)/(1-i-n),new Float32Array([d,v,a,A,i,n,e,t])}function o(u,c,g,B,m,b){var y,F,E,p,x,Q,G,D,O,U,r,h,s,_;for(O=0;O<b;O++){for(Q=O*m,G=O,D=0,y=u[Q],x=y*B[6],p=x,r=B[0],h=B[1],s=B[4],_=B[5],U=0;U<m;U++)F=u[Q],E=F*r+y*h+p*s+x*_,x=p,p=E,y=F,g[D]=p,D++,Q++;for(Q--,D--,G+=b*(m-1),y=u[Q],x=y*B[7],p=x,F=y,r=B[2],h=B[3],U=m-1;U>=0;U--)E=F*r+y*h+p*s+x*_,x=p,p=E,y=F,F=u[Q],c[G]=g[D]+p,Q--,D--,G-=b}}function f(u,c,g,B){if(B){var m=new Uint16Array(u.length),b=new Float32Array(Math.max(c,g)),y=I(B);o(u,m,b,y,c,g),o(m,u,b,y,g,c)}}C.exports=f},{}],19:[function(w,C,S){var d=w("object-assign"),v=w("./lib/base64decode"),a=w("./lib/wa_detect"),A={js:!0,wasm:!0};function i(n){if(!(this instanceof i))return new i(n);var e=d({},A,n||{});if(this.options=e,this.__cache={},this.__init_promise=null,this.__modules=e.modules||{},this.__memory=null,this.__wasm={},this.__isLE=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1,!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}i.prototype.has_wasm=a,i.prototype.use=function(n){return this.__modules[n.name]=n,this.options.wasm&&this.has_wasm()&&n.wasm_fn?this[n.name]=n.wasm_fn:this[n.name]=n.fn,this},i.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error(`mathlib: only "wasm" was enabled, but it's not supported`));var n=this;return this.__init_promise=Promise.all(Object.keys(n.__modules).map(function(e){var t=n.__modules[e];return!n.options.wasm||!n.has_wasm()||!t.wasm_fn||n.__wasm[e]?null:WebAssembly.compile(n.__base64decode(t.wasm_src)).then(function(I){n.__wasm[e]=I})})).then(function(){return n}),this.__init_promise},i.prototype.__base64decode=v,i.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/(64*1024))}),this.__memory;var t=this.__memory.buffer.byteLength;return t<e&&this.__memory.grow(Math.ceil((e-t)/(64*1024))),this.__memory},i.prototype.__instance=function(e,t,I){if(t&&this.__reallocate(t),!this.__wasm[e]){var o=this.__modules[e];this.__wasm[e]=new WebAssembly.Module(this.__base64decode(o.wasm_src))}if(!this.__cache[e]){var f={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:d(f,I||{})})}return this.__cache[e]},i.prototype.__align=function(e,t){t=t||8;var I=e%t;return e+(I?t-I:0)},C.exports=i},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(w,C,S){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";C.exports=function(a){for(var A=a.replace(/[\r\n=]/g,""),i=A.length,n=new Uint8Array(i*3>>2),e=0,t=0,I=0;I<i;I++)I%4===0&&I&&(n[t++]=e>>16&255,n[t++]=e>>8&255,n[t++]=e&255),e=e<<6|d.indexOf(A.charAt(I));var o=i%4*6;return o===0?(n[t++]=e>>16&255,n[t++]=e>>8&255,n[t++]=e&255):o===18?(n[t++]=e>>10&255,n[t++]=e>>2&255):o===12&&(n[t++]=e>>4&255),n}},{}],21:[function(w,C,S){var d;C.exports=function(){if(typeof d<"u"||(d=!1,typeof WebAssembly>"u"))return d;try{var a=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),A=new WebAssembly.Module(a),i=new WebAssembly.Instance(A,{});return i.exports.test(4)!==0&&(d=!0),d}catch{}return d}},{}],22:[function(w,C,S){var d=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function A(n){if(n==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(n)}function i(){try{if(!Object.assign)return!1;var n=new String("abc");if(n[5]="de",Object.getOwnPropertyNames(n)[0]==="5")return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;var I=Object.getOwnPropertyNames(e).map(function(f){return e[f]});if(I.join("")!=="0123456789")return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(f){o[f]=f}),Object.keys(Object.assign({},o)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}C.exports=i()?Object.assign:function(n,e){for(var t,I=A(n),o,f=1;f<arguments.length;f++){t=Object(arguments[f]);for(var u in t)v.call(t,u)&&(I[u]=t[u]);if(d){o=d(t);for(var c=0;c<o.length;c++)a.call(t,o[c])&&(I[o[c]]=t[o[c]])}}return I}},{}],23:[function(w,C,S){var d=arguments[3],v=arguments[4],a=arguments[5],A=JSON.stringify;C.exports=function(i,n){for(var e,t=Object.keys(a),I=0,o=t.length;I<o;I++){var f=t[I],u=a[f].exports;if(u===i||u&&u.default===i){e=f;break}}if(!e){e=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var c={},I=0,o=t.length;I<o;I++){var f=t[I];c[f]=f}v[e]=["function(require,module,exports){"+i+"(self); }",c]}var g=Math.floor(Math.pow(16,8)*Math.random()).toString(16),B={};B[e]=e,v[g]=["function(require,module,exports){var f = require("+A(e)+");(f.default ? f.default : f)(self);}",B];var m={};b(g);function b(Q){m[Q]=!0;for(var G in v[Q][1]){var D=v[Q][1][G];m[D]||b(D)}}var y="("+d+")({"+Object.keys(m).map(function(Q){return A(Q)+":["+v[Q][0]+","+A(v[Q][1])+"]"}).join(",")+"},{},["+A(g)+"])",F=window.URL||window.webkitURL||window.mozURL||window.msURL,E=new Blob([y],{type:"text/javascript"});if(n&&n.bare)return E;var p=F.createObjectURL(E),x=new Worker(p);return x.objectURL=p,x}},{}],"/index.js":[function(w,C,S){function d(r,h){return n(r)||i(r,h)||a(r,h)||v()}function v(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a(r,h){if(r){if(typeof r=="string")return A(r,h);var s=Object.prototype.toString.call(r).slice(8,-1);if(s==="Object"&&r.constructor&&(s=r.constructor.name),s==="Map"||s==="Set")return Array.from(r);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return A(r,h)}}function A(r,h){(h==null||h>r.length)&&(h=r.length);for(var s=0,_=new Array(h);s<h;s++)_[s]=r[s];return _}function i(r,h){var s=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(s!=null){var _=[],l=!0,k=!1,M,R;try{for(s=s.call(r);!(l=(M=s.next()).done)&&(_.push(M.value),!(h&&_.length===h));l=!0);}catch(H){k=!0,R=H}finally{try{!l&&s.return!=null&&s.return()}finally{if(k)throw R}}return _}}function n(r){if(Array.isArray(r))return r}var e=w("object-assign"),t=w("webworkify"),I=w("./lib/mathlib"),o=w("./lib/pool"),f=w("./lib/utils"),u=w("./lib/worker"),c=w("./lib/stepper"),g=w("./lib/tiler"),B=w("./lib/mm_resize/resize_filter_info"),m={},b=!1;try{typeof navigator<"u"&&navigator.userAgent&&(b=navigator.userAgent.indexOf("Safari")>=0)}catch{}var y=1;typeof navigator<"u"&&(y=Math.min(navigator.hardwareConcurrency||1,4));var F={tile:1024,concurrency:y,features:["js","wasm","ww"],idle:2e3,createCanvas:function(h,s){var _=document.createElement("canvas");return _.width=h,_.height=s,_}},E={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},p=!1,x=!1,Q=!1,G=!1,D=!1;function O(){return{value:t(u),destroy:function(){if(this.value.terminate(),typeof window<"u"){var h=window.URL||window.webkitURL||window.mozURL||window.msURL;h&&h.revokeObjectURL&&this.value.objectURL&&h.revokeObjectURL(this.value.objectURL)}}}}function U(r){if(!(this instanceof U))return new U(r);this.options=e({},F,r||{});var h="lk_".concat(this.options.concurrency);this.__limit=m[h]||f.limiter(this.options.concurrency),m[h]||(m[h]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}U.prototype.init=function(){var r=this;if(this.__initPromise)return this.__initPromise;if(typeof ImageData<"u"&&typeof Uint8ClampedArray<"u")try{new ImageData(new Uint8ClampedArray(400),10,10),p=!0}catch{}typeof ImageBitmap<"u"&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?x=!0:this.debug("ImageBitmap does not support .close(), disabled"));var h=this.options.features.slice();if(h.indexOf("all")>=0&&(h=["cib","wasm","js","ww"]),this.__requested_features=h,this.__mathlib=new I(h),h.indexOf("ww")>=0&&typeof window<"u"&&"Worker"in window)try{var s=w("webworkify")(function(){});s.terminate(),this.features.ww=!0;var _="wp_".concat(JSON.stringify(this.options));m[_]?this.__workersPool=m[_]:(this.__workersPool=new o(O,this.options.idle),m[_]=this.__workersPool)}catch{}var l=this.__mathlib.init().then(function(H){e(r.features,H.features)}),k;x?k=f.cib_support(this.options.createCanvas).then(function(H){if(r.features.cib&&h.indexOf("cib")<0){r.debug("createImageBitmap() resize supported, but disabled by config");return}h.indexOf("cib")>=0&&(r.features.cib=H)}):k=Promise.resolve(!1),Q=f.can_use_canvas(this.options.createCanvas);var M;x&&p&&h.indexOf("ww")!==-1?M=f.worker_offscreen_canvas_support():M=Promise.resolve(!1),M=M.then(function(H){G=H});var R=f.cib_can_use_region().then(function(H){D=H});return this.__initPromise=Promise.all([l,k,M,R]).then(function(){return r}),this.__initPromise},U.prototype.__invokeResize=function(r,h){var s=this;return h.__mathCache=h.__mathCache||{},Promise.resolve().then(function(){return s.features.ww?new Promise(function(_,l){var k=s.__workersPool.acquire();h.cancelToken&&h.cancelToken.catch(function(R){return l(R)}),k.value.onmessage=function(R){k.release(),R.data.err?l(R.data.err):_(R.data)};var M=[];r.src&&M.push(r.src.buffer),r.srcBitmap&&M.push(r.srcBitmap),k.value.postMessage({opts:r,features:s.__requested_features,preload:{wasm_nodule:s.__mathlib.__}},M)}):{data:s.__mathlib.resizeAndUnsharp(r,h.__mathCache)}})},U.prototype.__extractTileData=function(r,h,s,_,l){if(this.features.ww&&G&&(f.isCanvas(h)||D))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(_.srcImageBitmap||h,r.x,r.y,r.width,r.height).then(function(R){return l.srcBitmap=R,l});if(f.isCanvas(h))return _.srcCtx||(_.srcCtx=h.getContext("2d")),this.debug("Get tile pixel data"),l.src=_.srcCtx.getImageData(r.x,r.y,r.width,r.height).data,l;this.debug("Draw tile imageBitmap/image to temporary canvas");var k=this.options.createCanvas(r.width,r.height),M=k.getContext("2d");return M.globalCompositeOperation="copy",M.drawImage(_.srcImageBitmap||h,r.x,r.y,r.width,r.height,0,0,r.width,r.height),this.debug("Get tile pixel data"),l.src=M.getImageData(0,0,r.width,r.height).data,k.width=k.height=0,l},U.prototype.__landTileData=function(r,h,s){var _;if(this.debug("Convert raw rgba tile result to ImageData"),h.bitmap)return s.toCtx.drawImage(h.bitmap,r.toX,r.toY),null;if(p)_=new ImageData(new Uint8ClampedArray(h.data),r.toWidth,r.toHeight);else if(_=s.toCtx.createImageData(r.toWidth,r.toHeight),_.data.set)_.data.set(h.data);else for(var l=_.data.length-1;l>=0;l--)_.data[l]=h.data[l];return this.debug("Draw tile"),b?s.toCtx.putImageData(_,r.toX,r.toY,r.toInnerX-r.toX,r.toInnerY-r.toY,r.toInnerWidth+1e-5,r.toInnerHeight+1e-5):s.toCtx.putImageData(_,r.toX,r.toY,r.toInnerX-r.toX,r.toInnerY-r.toY,r.toInnerWidth,r.toInnerHeight),null},U.prototype.__tileAndResize=function(r,h,s){var _=this,l={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null},k=function(R){return _.__limit(function(){if(s.canceled)return s.cancelToken;var H={width:R.width,height:R.height,toWidth:R.toWidth,toHeight:R.toHeight,scaleX:R.scaleX,scaleY:R.scaleY,offsetX:R.offsetX,offsetY:R.offsetY,filter:s.filter,unsharpAmount:s.unsharpAmount,unsharpRadius:s.unsharpRadius,unsharpThreshold:s.unsharpThreshold};return _.debug("Invoke resize math"),Promise.resolve(H).then(function(P){return _.__extractTileData(R,r,s,l,P)}).then(function(P){return _.debug("Invoke resize math"),_.__invokeResize(P,s)}).then(function(P){return s.canceled?s.cancelToken:(l.srcImageData=null,_.__landTileData(R,P,l))})})};return Promise.resolve().then(function(){if(l.toCtx=h.getContext("2d"),f.isCanvas(r))return null;if(f.isImageBitmap(r))return l.srcImageBitmap=r,l.isImageBitmapReused=!0,null;if(f.isImage(r))return x?(_.debug("Decode image via createImageBitmap"),createImageBitmap(r).then(function(M){l.srcImageBitmap=M}).catch(function(M){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(s.canceled)return s.cancelToken;_.debug("Calculate tiles");var M=g({width:s.width,height:s.height,srcTileSize:_.options.tile,toWidth:s.toWidth,toHeight:s.toHeight,destTileBorder:s.__destTileBorder}),R=M.map(function(P){return k(P)});function H(P){P.srcImageBitmap&&(P.isImageBitmapReused||P.srcImageBitmap.close(),P.srcImageBitmap=null)}return _.debug("Process tiles"),Promise.all(R).then(function(){return _.debug("Finished!"),H(l),h},function(P){throw H(l),P})})},U.prototype.__processStages=function(r,h,s,_){var l=this;if(_.canceled)return _.cancelToken;var k=r.shift(),M=d(k,2),R=M[0],H=M[1],P=r.length===0,L;P||B.q2f.indexOf(_.filter)<0?L=_.filter:_.filter==="box"?L="box":L="hamming",_=e({},_,{toWidth:R,toHeight:H,filter:L});var j;return P||(j=this.options.createCanvas(R,H)),this.__tileAndResize(h,P?s:j,_).then(function(){return P?s:(_.width=R,_.height=H,l.__processStages(r,j,s,_))}).then(function(z){return j&&(j.width=j.height=0),z})},U.prototype.__resizeViaCreateImageBitmap=function(r,h,s){var _=this,l=h.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(r,{resizeWidth:s.toWidth,resizeHeight:s.toHeight,resizeQuality:f.cib_quality_name(B.f2q[s.filter])}).then(function(k){if(s.canceled)return s.cancelToken;if(!s.unsharpAmount)return l.drawImage(k,0,0),k.close(),l=null,_.debug("Finished!"),h;_.debug("Unsharp result");var M=_.options.createCanvas(s.toWidth,s.toHeight),R=M.getContext("2d");R.drawImage(k,0,0),k.close();var H=R.getImageData(0,0,s.toWidth,s.toHeight);return _.__mathlib.unsharp_mask(H.data,s.toWidth,s.toHeight,s.unsharpAmount,s.unsharpRadius,s.unsharpThreshold),l.putImageData(H,0,0),M.width=M.height=0,H=R=M=l=null,_.debug("Finished!"),h})},U.prototype.resize=function(r,h,s){var _=this;this.debug("Start resize...");var l=e({},E);if(isNaN(s)?s&&(l=e(l,s)):l=e(l,{quality:s}),l.toWidth=h.width,l.toHeight=h.height,l.width=r.naturalWidth||r.width,l.height=r.naturalHeight||r.height,Object.prototype.hasOwnProperty.call(l,"quality")){if(l.quality<0||l.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(l.quality));l.filter=B.q2f[l.quality]}if(h.width===0||h.height===0)return Promise.reject(new Error("Invalid output size: ".concat(h.width,"x").concat(h.height)));l.unsharpRadius>2&&(l.unsharpRadius=2),l.canceled=!1,l.cancelToken&&(l.cancelToken=l.cancelToken.then(function(M){throw l.canceled=!0,M},function(M){throw l.canceled=!0,M}));var k=3;return l.__destTileBorder=Math.ceil(Math.max(k,2.5*l.unsharpRadius|0)),this.init().then(function(){if(l.canceled)return l.cancelToken;if(_.features.cib){if(B.q2f.indexOf(l.filter)>=0)return _.__resizeViaCreateImageBitmap(r,h,l);_.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!Q){var M=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw M.code="ERR_GET_IMAGE_DATA",M}var R=c(l.width,l.height,l.toWidth,l.toHeight,_.options.tile,l.__destTileBorder);return _.__processStages(R,r,h,l)})},U.prototype.resizeBuffer=function(r){var h=this,s=e({},E,r);if(Object.prototype.hasOwnProperty.call(s,"quality")){if(s.quality<0||s.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(s.quality));s.filter=B.q2f[s.quality]}return this.init().then(function(){return h.__mathlib.resizeAndUnsharp(s)})},U.prototype.toBlob=function(r,h,s){return h=h||"image/png",new Promise(function(_){if(r.toBlob){r.toBlob(function(H){return _(H)},h,s);return}if(r.convertToBlob){_(r.convertToBlob({type:h,quality:s}));return}for(var l=atob(r.toDataURL(h,s).split(",")[1]),k=l.length,M=new Uint8Array(k),R=0;R<k;R++)M[R]=l.charCodeAt(R);_(new Blob([M],{type:h}))})},U.prototype.debug=function(){},C.exports=U},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")})}(q)),q.exports}var J=X();const V=N(J);export{V as p};
