import{m as P,g as S,j as e,b as y,r as c,ag as ce,n as F,aw as le,ar as de,aU as pe,aQ as ue,v as T,R as me,q as ge,aH as _e,aI as V,aJ as G}from"./index-r1diih1v.js";import{f as he,B as q,a1 as Y,N as xe,y as fe,u as ve,a2 as je,c as ye,a3 as Ce,a4 as Ae,a as be,G as j,Z,e as B,H as L,a5 as ke,i as Se,s as Q,R as we}from"./index-CdXxJyXX.js";import{u as Me}from"./useCSSKeyframesAnimationController-C_nR4Q43.js";import{C as Re,a as De}from"./CardScroll-BHa2RLwl.js";import{M as E}from"./MiniInfoCell-2oGTEhOc.js";import{h as Ie}from"./moment-C5S46NFB.js";var U=P("Icon28ErrorCircleOutline","error_circle_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="error_circle_outline_28"><path fill="currentColor" d="M14 2c6.627 0 12 5.373 12 12s-5.373 12-12 12S2 20.627 2 14 7.373 2 14 2m0 2C8.477 4 4 8.477 4 14s4.477 10 10 10 10-4.477 10-10S19.523 4 14 4m0 13.6a1.4 1.4 0 1 1 0 2.8 1.4 1.4 0 0 1 0-2.8m.074-9.6c.237 0 .386.037.517.107q.196.106.302.302c.07.13.107.28.107.517v6.148c0 .237-.037.386-.107.517a.73.73 0 0 1-.302.302c-.13.07-.28.107-.517.107h-.148c-.237 0-.386-.037-.517-.107a.73.73 0 0 1-.302-.302c-.07-.13-.107-.28-.107-.517V8.926c0-.237.037-.386.107-.517a.73.73 0 0 1 .302-.302c.13-.07.28-.107.517-.107z" /></symbol>',28,28),J=P("Icon28SpeedometerMaxOutline","speedometer_max_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="speedometer_max_outline_28"><path fill="currentColor" d="M14 2c1.687 0 3.294.348 4.751.978l.328.147a12 12 0 0 1 3.406 2.39A11.97 11.97 0 0 1 26 14q0 .638-.065 1.26a1 1 0 0 1-1.99-.208Q24 14.534 24 14a9.97 9.97 0 0 0-2.929-7.071 10 10 0 0 0-3.112-2.115l-.005-.002A10 10 0 0 0 14 4a9.96 9.96 0 0 0-4.7 1.17l-.066.036A10 10 0 0 0 6.93 6.93 9.97 9.97 0 0 0 4 14c0 2.014.594 3.886 1.617 5.454a1 1 0 1 1-1.676 1.092A11.95 11.95 0 0 1 2 14c0-3.313 1.344-6.315 3.515-8.485a12 12 0 0 1 3.74-2.54l.006-.002A12 12 0 0 1 14 2" /><path fill="currentColor" fill-rule="evenodd" d="m16.077 11.8 8.905 7.247c1 .813.084 2.4-1.12 1.94L13.131 16.9a3 3 0 0 1-.318-.143 3 3 0 1 1 2.979-5.162q.146.093.284.205M14.5 13.133a1 1 0 1 0-1 1.732 1 1 0 0 0 1-1.732" clip-rule="evenodd" /></symbol>',28,28),K=P("Icon28SpeedometerMiddleOutline","speedometer_middle_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 28 28" id="speedometer_middle_outline_28"><path fill-rule="evenodd" d="M16.944 13.302 15.121 1.966c-.205-1.273-2.037-1.273-2.242 0l-1.823 11.336a3 3 0 0 0-.036.347 3 3 0 1 0 5.96.001 3 3 0 0 0-.036-.348M15 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd" /><path d="M17.431 3.498a1 1 0 0 1 1.314-.523 12 12 0 0 1 3.74 2.54A11.97 11.97 0 0 1 26 14c0 2.413-.713 4.663-1.941 6.546a1 1 0 1 1-1.676-1.092A9.95 9.95 0 0 0 24 14a9.97 9.97 0 0 0-2.929-7.071 10 10 0 0 0-3.117-2.117 1 1 0 0 1-.523-1.314m-6.868.002a1 1 0 0 1-.522 1.314A10 10 0 0 0 6.93 6.929 9.97 9.97 0 0 0 4 14c0 2.014.594 3.886 1.617 5.454a1 1 0 1 1-1.676 1.092A11.95 11.95 0 0 1 2 14c0-3.313 1.344-6.315 3.515-8.485a12 12 0 0 1 3.734-2.537 1 1 0 0 1 1.314.521Z" /></symbol>',28,28),X=P("Icon28SpeedometerStartOutline","speedometer_start_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 28 28" id="speedometer_start_outline_28"><path d="M14 2c-1.687 0-3.293.348-4.751.978l-.328.147a12 12 0 0 0-3.406 2.39A11.97 11.97 0 0 0 2 14q0 .638.065 1.26a1 1 0 0 0 1.99-.208A10 10 0 0 1 4 14a9.97 9.97 0 0 1 2.929-7.071 10 10 0 0 1 3.112-2.115l.005-.002A10 10 0 0 1 14 4a9.96 9.96 0 0 1 4.7 1.17l.066.036c.85.462 1.626 1.044 2.305 1.723A9.97 9.97 0 0 1 24 14a9.95 9.95 0 0 1-1.617 5.454 1 1 0 1 0 1.676 1.092A11.95 11.95 0 0 0 26 14c0-3.313-1.344-6.315-3.515-8.485a12 12 0 0 0-3.74-2.54l-.006-.002A12 12 0 0 0 14 2" /><path fill-rule="evenodd" d="m11.923 11.8-8.905 7.247c-1 .813-.084 2.4 1.12 1.94l10.73-4.088q.165-.063.318-.143a3 3 0 1 0-2.979-5.162q-.146.093-.284.205Zm1.577 1.334a1 1 0 1 1 1 1.732 1 1 0 0 1-1-1.732" clip-rule="evenodd" /></symbol>',28,28);const Ne="_host_18tpg_1",$e="_desktop_18tpg_19",He="_opening_18tpg_23",Le="_closing_18tpg_28",Ee="_content_18tpg_45",Pe="_contentWithButton_18tpg_51",ze="_action_18tpg_56",Be="_actions_18tpg_61",We="_title_18tpg_69",Oe="_description_18tpg_74",Ve="_actionsDirectionHorizontal_18tpg_83",qe="_actionsDirectionVertical_18tpg_87",Fe="_actionsAlignLeft_18tpg_98",Te="_actionsAlignCenter_18tpg_103",Ge="_actionsAlignRight_18tpg_108",Ye="_ios_18tpg_117",Ze="_actionModeCancel_18tpg_256",Qe="_actionModeDestructive_18tpg_260",Ue="_vkcom_18tpg_268",Je="_button_18tpg_285",Ke="_buttonModeCancel_18tpg_289",Xe="_dismiss_18tpg_293",o={host:Ne,desktop:$e,opening:He,"animation-alert-scale-up":"_animation-alert-scale-up_18tpg_1",closing:Le,"animation-alert-scale-down":"_animation-alert-scale-down_18tpg_1",content:Ee,contentWithButton:Pe,action:ze,actions:Be,title:We,description:Oe,actionsDirectionHorizontal:Ve,actionsDirectionVertical:qe,actionsAlignLeft:Fe,actionsAlignCenter:Te,actionsAlignRight:Ge,ios:Ye,actionModeCancel:Ze,actionModeDestructive:Qe,vkcom:Ue,button:Je,buttonModeCancel:Ke,dismiss:Xe},et=({mode:t,...s})=>e.jsx(he,{Component:s.href?"a":"button",baseClassName:y(o.action,t==="destructive"&&o.actionModeDestructive,t==="cancel"&&o.actionModeCancel),...s}),tt=({mode:t,...s})=>{const r=S();let i="tertiary";return r==="vkcom"&&(i=t==="cancel"?"secondary":"primary"),e.jsx(q,{className:y(o.button,t==="cancel"&&o.buttonModeCancel),mode:i,size:"m",...s})},st=t=>S()==="ios"?e.jsx(et,{...t}):e.jsx(tt,{...t}),ot={left:o.actionsAlignLeft,center:o.actionsAlignCenter,right:o.actionsAlignRight},nt={vertical:o.actionsDirectionVertical,horizontal:o.actionsDirectionHorizontal},at=({actions:t=[],renderAction:s=m=>e.jsx(st,{...m}),onItemClick:r,actionsAlign:i,actionsLayout:l})=>{const g=S()==="vkcom"?"horizontal":l;return e.jsx("div",{className:y(o.actions,i&&ot[i],g&&nt[g]),children:t.map((h,f)=>{const{title:C,action:d,autoCloseDisabled:v,...a}=h;return e.jsx(c.Fragment,{children:s({children:C,onClick:()=>r(h),...a})},f)})})},rt=t=>{switch(S()){case"ios":return e.jsx(Y,{className:o.title,weight:"1",level:"3",...t});default:return e.jsx(Y,{className:o.title,weight:"2",level:"2",...t})}},it=t=>{switch(S()){case"vkcom":return e.jsx(ce,{className:o.description,...t});case"ios":return e.jsx(fe,{className:o.description,...t});default:return e.jsx(xe,{Component:"span",className:o.description,weight:"3",...t})}},ct=({actions:t,actionsLayout:s="horizontal",children:r,className:i,style:l,title:m,description:g,onClose:h,dismissLabel:f="Закрыть предупреждение",renderAction:C,actionsAlign:d,dismissButtonMode:v="outside",dismissButtonTestId:a,getRootRef:z,usePortal:w,...p})=>{const A=c.useId(),b=`vkui-alert-${A}-title`,M=`vkui-alert-${A}-description`,R=S(),{isDesktop:D}=ve(),[n,_]=c.useState(!1),x=c.useRef(F),[$,u]=Me(n?"exit":"enter",{onExited(){x.current(),x.current=F,h()}}),I=D&&R!=="ios",ne=c.useRef(null),k=c.useCallback(()=>{_(!0)},[]),ae=c.useCallback(re=>{const{action:H,autoCloseDisabled:ie=!1}=re;ie?H&&H({close:k}):(H&&(x.current=H),_(!0))},[k]);return le(),e.jsx(de,{usePortal:w,children:e.jsx(pe,{className:i,closing:n,style:l,onClick:k,getRootRef:z,children:e.jsxs(je,{...p,...u,getRootRef:ne,onClick:ue,onClose:k,autoFocus:$==="entered",className:y(o.host,R==="ios"&&o.ios,R==="vkcom"&&o.vkcom,n?o.closing:o.opening,D&&o.desktop),role:"alertdialog","aria-modal":!0,"aria-labelledby":b,"aria-describedby":M,children:[e.jsxs("div",{className:y(o.content,v==="inside"&&o.contentWithButton),children:[T(m)&&e.jsx(rt,{id:b,children:m}),T(g)&&e.jsx(it,{id:M,children:g}),r,I&&v==="inside"&&e.jsx(ye,{label:f,className:y(o.dismiss,"vkuiInternalAlert__dismiss"),onClick:k,hoverMode:"opacity",activeMode:"opacity","data-testid":a,children:e.jsx(Ce,{})})]}),e.jsx(at,{actions:t,actionsAlign:d,actionsLayout:s,renderAction:C,onItemClick:ae}),I&&v==="outside"&&e.jsx(Ae,{onClick:k,"data-testid":a,children:f})]})})})},lt="_host_172c9_1",dt="_appearanceAccent_172c9_13",pt="_appearancePositive_172c9_17",ut="_appearanceNegative_172c9_21",N={host:lt,in:"_in_172c9_7",appearanceAccent:dt,appearancePositive:pt,appearanceNegative:ut},mt={accent:N.appearanceAccent,positive:N.appearancePositive,negative:N.appearanceNegative};function gt(t){return t?{height:t,borderRadius:t/2}:void 0}const ee=0,W=100,_t=({value:t=0,appearance:s="accent",height:r,...i})=>{const l=ge(t,ee,W),m=`${l} / ${W}`,g=gt(r);return e.jsx(me,{"aria-valuenow":t,title:m,...i,role:"progressbar","aria-valuemin":ee,"aria-valuemax":W,baseClassName:y(N.host,mt[s]),baseStyle:g,children:e.jsx("div",{className:N.in,style:{width:`${l}%`}})})},ht={light:{current:{backgroundColor:"green",color:"white",padding:"3px",borderRadius:"3px"},invalid:{backgroundColor:"red",color:"white",padding:"3px",borderRadius:"3px"},valid:{color:"green"},default:{color:"black"}},dark:{current:{backgroundColor:"green",color:"white",padding:"3px",borderRadius:"3px"},invalid:{backgroundColor:"red",color:"white",padding:"3px",borderRadius:"3px"},valid:{color:"green"},default:{color:"white"}}},xt=({value:t,status:s})=>e.jsx("span",{style:ht[V.theme][s],children:t}),te=t=>{const s=t.split("").map(r=>({value:r,status:"default"}));return s[0].status="current",s},ft={ru:/^[ЁёА-я\s]/,en:/^[a-zA-Z\s]/},oe=(t,s)=>t.date<s.date?1:-1,se=(t,s)=>{const[r,i]=[t.cpm/t.errors,s.cpm/s.errors];return r>i?-1:r<i?1:t.cpm>s.cpm?-1:t.cpm<s.cpm?1:0};class O{static load(){return Q.utils.storage.speedtype.history.slice()}static save(s){s.length>100&&(s.sort(oe),s=s.slice(0,100)),Q.utils.storage.speedtype.history=s}}const vt=()=>{const[t,s]=c.useState(),[r,i]=c.useState(0),[l,m]=c.useState(0),[g,h]=c.useState(0),[f,C]=c.useState(!1),[d,v]=c.useState(O.load()),{t:a,i18n:z}=be("translation",{keyPrefix:"pages.utils.list.speedtype"}),w=a("text"),[p,A]=c.useState(te(w)),b=n=>e.jsx(De,{mode:"outline",style:{textAlign:"center"},children:e.jsxs(we,{hasActive:!1,hasHover:!1,subtitle:z.t(`languages.${n.lang}`),extraSubtitle:Ie(n.date).format("DD.MM.YYYY, HH:mm:ss"),children:[e.jsxs(E,{before:n.cpm<200?e.jsx(X,{}):n.cpm<400?e.jsx(K,{}):e.jsx(J,{}),textWrap:"short",children:[a("cpm"),": ",n.cpm]}),e.jsxs(E,{before:e.jsx(U,{fill:`rgb(${150+n.errors}, ${162-n.errors*8.1}, ${173-n.errors*8.65})`}),textWrap:"short",children:[a("errors"),": ",n.errors]})]})}),M=()=>{i(0),m(0),h(0),A(te(w))},R=n=>{if(!ft[V.language].test(n)){G.popout=e.jsx(ct,{actions:[{title:a("continue"),mode:"default"}],description:a("switchLayout"),onClose:()=>{G.popout=null}});return}const _=p.findIndex(u=>u.status==="current"||u.status==="invalid"),x=p[_];_===0&&x.status==="current"&&s(Date.now());debugger;const $=()=>{let u=Math.floor(60/((Date.now()-t)/1e3/_));return isNaN(u)&&(u=0),u};if(n===x.value)if(x.status="valid",_+1===p.length){A([]),h(_/(p.length/100));const u=$();i(u);const I=[...d,{lang:V.language,cpm:u,errors:l,date:t}];v(I),O.save(I),C(!1);return}else p[_+1].status="current";else x.status="invalid",m(l+1);h(_/(p.length/100)),i($()),A([...p])},D=n=>{n.preventDefault(),(f||n.key===w[0])&&(C(!0),R(n.key))};return c.useEffect(()=>(document.addEventListener("keypress",D),()=>{document.removeEventListener("keypress",D)}),[r,t,l,d,g,f]),e.jsxs(j,{children:[p.length>0&&e.jsxs(Z,{onClick:()=>{var n;(n=document.getElementById("input"))==null||n.focus()},children:[e.jsx(_t,{value:g}),e.jsx(B,{size:28}),e.jsx("div",{style:{textAlign:"center"},children:p.map(xt)})]}),e.jsxs(j,{mode:"plain",header:e.jsx(L,{children:a("results")}),children:[e.jsxs(E,{before:r<200?e.jsx(X,{}):r<400?e.jsx(K,{}):e.jsx(J,{}),textWrap:"short",children:[a("cpm"),": ",r]}),e.jsxs(E,{before:e.jsx(U,{fill:`rgb(${150+l}, ${162-l*8.1}, ${173-l*8.65})`}),textWrap:"short",children:[a("errors"),": ",l]}),p.length===0&&e.jsx(Z,{style:{display:"flex",justifyContent:"center"},children:e.jsx(q,{appearance:"positive",stretched:!0,size:"l",onClick:M,children:a("restart")})})]}),d.length>0&&e.jsxs(j,{mode:"plain",children:[e.jsx(j,{separator:"hide",mode:"plain",style:{textAlign:"center"},description:`${a("formula")}: ${a("cpm")} / ${a("errors")}`,children:e.jsxs("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"center"},children:[e.jsxs(j,{style:{marginRight:d.length>1?"5px":void 0},separator:"hide",mode:"plain",children:[e.jsx(L,{children:a("bestResult")}),b(d.sort(se)[0])]}),d.length>1&&e.jsxs(j,{style:{marginLeft:"5px"},separator:"hide",mode:"plain",children:[e.jsx(L,{children:a("worstResult")}),b(d.sort(se)[d.length-1])]})]})}),e.jsx(B,{}),e.jsx(j,{mode:"plain",header:e.jsx(L,{after:`${a("total")}: ${d.length}`,children:a("history")}),children:e.jsx(Re,{padding:!0,children:d.sort(oe).map(b)})}),e.jsx(B,{}),e.jsx(ke,{}),e.jsx(Se,{hasActive:!1,hasHover:!1,children:e.jsx(q,{size:"m",mode:"primary",appearance:"negative",onClick:()=>{v([]),O.save([]),M()},children:a("clearHistory")})})]})]})},St=_e(vt);export{St as default};
